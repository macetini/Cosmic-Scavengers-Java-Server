syntax = "proto3";

package cosmic.scavengers;

option java_package = "com.cosmic.scavengers.network.proto";
option java_multiple_files = true;

// =========================================================================
// NOTE ON FIXED-POINT ARITHMETIC
// =========================================================================
// All 'int64' fields representing position, speed, or velocity components 
// are the UN-SCALED long values of the decimal4j Decimal<Scale4f> type. 
// On the client and server, these values must be re-interpreted using 
// a fixed scale of 4 (e.g., value of 1234567L means 123.4567).
// =========================================================================


// --- 1. Core Data Structures ---

// Represents a fixed-point 2D vector for position or velocity.
message Vector2D {
  // Unscaled long value of the X-coordinate (Scale4f)
  int64 x = 1; 
  // Unscaled long value of the Y-coordinate (Scale4f)
  int64 y = 2;
}

// Represents the state of an active movement component.
message MovementData {
  // The final destination target for the entity.
  Vector2D target = 1; 
  // Unscaled long value of the movement speed (Scale4f)
  int64 speed_unscaled = 2;
}


// --- 2. Server -> Client Synchronization Messages ---

// Represents a snapshot of a single entity's state.
message EntitySnapshot {
  // Unique ID of the entity.
  int64 entity_id = 1;
  // Current position of the entity.
  Vector2D position = 2;
  // The type of the entity (e.g., PLAYER, ASTEROID, SHIP).
  EntityType type = 3; 

  // Movement is optional; only included if the entity is currently moving.
  MovementData movement = 4; 
}

// The main message containing the state of the entire game world.
message WorldState {
  // The current simulation tick number. Critical for client prediction/reconciliation.
  int64 tick_number = 1;
  // A list of all entities in the current simulation state.
  repeated EntitySnapshot entities = 2;
}


// --- 3. Client -> Server Command Messages ---

// Base message for all client inputs that modify the game state.
message ClientCommand {
    // The client's unique user ID.
    string client_id = 1; 
    // The command being issued by the client.
    oneof command {
        // Command to start moving an entity to a new target.
        MoveCommand move_command = 2;
        // Command to interact with the world (e.g., mining, docking).
        InteractCommand interact_command = 3;
    }
}

// Specific command for movement.
message MoveCommand {
    // The entity the client controls (e.g., their ship).
    int64 entity_id = 1;
    // The target position to move to.
    Vector2D target_position = 2;
    // The requested speed. The server should cap this based on entity stats.
    int64 speed_unscaled = 3;
}

// Placeholder for future interaction commands.
message InteractCommand {
    enum InteractionType {
        MINE_ASTEROID = 0;
        DOCK_STATION = 1;
    }
    InteractionType type = 1;
    int64 target_entity_id = 2;
}

// --- 4. Enums ---

enum EntityType {
    ENTITY_TYPE_UNSPECIFIED = 0;
    PLAYER_SHIP = 1;
    ASTEROID = 2;
    SPACE_STATION = 3;
}